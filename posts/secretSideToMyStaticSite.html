<!doctype html><html><head><meta charset="UTF-8"><meta charset="UTF-8"><meta name="viewport" content="width=device-width" initial-scale="1.0"><link rel="icon" type="image" href="/favicon/16x16.png" sizes="16x16"><link rel="icon" type="image" href="/favicon/32x32.png" sizes="32x32"><link rel="icon" type="image" href="/favicon/96x96.png" sizes="96x96"><link rel="stylesheet" href="/css/styles.css"><link rel="stylesheet" href="/css/highlight.css"><title>The Secret Side to My Static Site</title></head><body><div class="title">The Secret Side to My Static Site</div><div class="main"><div class="navbar"><span><a href="/">Home</a></span><span><a style="margin-left:3em;" href="/resume">Resume</a></span><span><a style="margin-left:3em;" href="/posts/list">Posts</a></span><span><a style="margin-left:3em;" href="/fractal">Fractal Generator</a></span></div><p>I host this website on github pages which means I don't have access to a server or database. In other words, my website is hosted on computers I don't own and is accessible by anyone.</p><p>And I want a login service.</p><p>Specifically I want a place where I can type in a password and gain access to private information. However, because my site is public, I have to be able to do this from any computer.</p><p>While I have been thinking about this problem for quite a while, it wasn't until I finished taking a cryptography class at college that I learned the tools to do this job. Specifically, AES.</p><p>AES is a secure encryption algorithm where you take your data and encrypt it with a key. When you want your data back, you use the key again to decrypt. As far as I know AES has a long enough key that it hasn't been cracked and it probably won't be cracked any time soon.</p><p>From a high level, I used AES to encrypt and decrypt the contents of my secret web pages with a password.</p><p>Before encryption, my secret website looks like:</p><div class="highlight"><pre><span></span>main.html
other.html
</pre></div><p>When my website is encrypted, the file structure looks as follows:</p><div class="highlight"><pre><span></span>007a69b693fbc1f43f7ce8f4c9779621.html
222e1238c95503abd14586130ee685c1.html
aes.js
landing.html
sha256.js
</pre></div><p>The html files with hex names correspond to <code>main.html</code> and <code>other.html</code>, and the additional files are libraries to help decrypt the pages.</p><p>I make sure to obfuscate the real file names to make it harder for people to get any information from even the file structure.</p><p><code>aes.js</code> and <code>sha256.js</code> are encryption libraries I found online and <code>landing.html</code> is the webpage through which you access the private site.</p><p>My claim is that it is very hard to decode the webpages without the password.</p><p>For example, this is what <code>007a69b693fbc1f43f7ce8f4c9779621.html</code> looks like:</p><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Encrypted Page<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;aes.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/javascript&quot;</span><span class="p">&gt;</span>
    <span class="kr">const</span> <span class="nx">page</span> <span class="o">=</span> <span class="s1">&#x27;9e030b9d0dddf39ba44fb1a82ab0c5181efd3dca33ea8e452646daef8522542bc08fc655c66c08f227db29fc3f632db4371a2a1b3971b65eaaf360459628be2d7cd19170faf5729422ac826d101f237a7ad418617efb6630c812b014f687e500f3a24d0944224351a9333dbc34bb3a8a5cad54eb82b0eeb498accadf3cbba5b644725b46a72b5ef1deb9e4125b7e03e80d72fd44383f81445fb49c013d321104091a841c593c30b640868337746db26e779196ce0a7a5d277cf48c4e504a7ad0a78f6806340549924f0336fc192a86f4282e43044b9d5c0e23cd8b1e847676a3fcfcb988d6039c43be92fb18ed64f595d3680b324c298892833dd82d6042bf630534a9&#x27;</span><span class="p">;</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">;</span>
      <span class="kr">const</span> <span class="nx">match</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/\?key=(.*)$/</span><span class="p">);</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">assert</span><span class="p">(</span><span class="nx">match</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">);</span>
      <span class="kr">const</span> <span class="nx">hexKey</span> <span class="o">=</span> <span class="nx">match</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">assert</span><span class="p">(</span><span class="nx">hexKey</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">32</span><span class="p">);</span>
      <span class="kr">const</span> <span class="nx">byteKey</span> <span class="o">=</span> <span class="nx">aesjs</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">hex</span><span class="p">.</span><span class="nx">toBytes</span><span class="p">(</span><span class="nx">hexKey</span><span class="p">);</span>
      <span class="kr">const</span> <span class="nx">aes</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">aesjs</span><span class="p">.</span><span class="nx">ModeOfOperation</span><span class="p">.</span><span class="nx">ctr</span><span class="p">(</span><span class="nx">byteKey</span><span class="p">,</span> <span class="k">new</span> <span class="nx">aesjs</span><span class="p">.</span><span class="nx">Counter</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
      <span class="kr">const</span> <span class="nx">pageBytes</span> <span class="o">=</span> <span class="nx">aesjs</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">hex</span><span class="p">.</span><span class="nx">toBytes</span><span class="p">(</span><span class="nx">page</span><span class="p">);</span>
      <span class="kr">const</span> <span class="nx">decryptedBytes</span> <span class="o">=</span> <span class="nx">aes</span><span class="p">.</span><span class="nx">decrypt</span><span class="p">(</span><span class="nx">pageBytes</span><span class="p">);</span>
      <span class="kr">const</span> <span class="nx">decryptedPage</span> <span class="o">=</span> <span class="nx">aesjs</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">utf8</span><span class="p">.</span><span class="nx">fromBytes</span><span class="p">(</span><span class="nx">decryptedBytes</span><span class="p">);</span>
      <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">decryptedPage</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div><p>It's pretty hard to tell that hex string decrypts into the following page.</p><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Encrypted Page<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;aes.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Main Page<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Welcome to the ecnrypted page!<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>You are here because you managed to type in the correct password.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Here&#x27;s a link to the <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;222e1238c95503abd14586130ee685c1.html?key=d74ff0ee8da3b9806b18c877dbf29bbd&quot;</span><span class="p">&gt;</span>other page<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div><p>When the page loads, it uses the key from the url to decrypt the page contents and sets the decrypted message as the body's innerHTML. From the user's perspective, the decryption happens instantly.</p><h1><img src="/svg/logo.svg" class="h1-img">The Landing Page</h1><p><code>landing.html</code> is very similar except it only stores the encrypted url of the first secret page.</p><p>To get the first link, the landing page:</p><ol><li>gets the first 128 bits of the sha256 of the password and a random salt.</li><li>uses those bits as an AES key to decrypt the link.</li><li>goes to the link and passes the AES key through the url.</li></ol><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Encrypted Page<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;aes.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;sha256.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/javascript&quot;</span><span class="p">&gt;</span>
    <span class="kr">const</span> <span class="nx">link</span> <span class="o">=</span> <span class="s1">&#x27;a2115315d3475b01bb63383b86fb7c51&#x27;</span><span class="p">;</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">input</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#x27;input&#x27;</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
      <span class="nx">input</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#x27;keydown&#x27;</span><span class="p">,</span> <span class="nx">event</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">key</span> <span class="o">===</span> <span class="s1">&#x27;Enter&#x27;</span><span class="p">)</span> <span class="p">{</span>
          <span class="kr">const</span> <span class="nx">pass</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
          <span class="kr">const</span> <span class="nx">m</span> <span class="o">=</span> <span class="nx">sha256</span><span class="p">.</span><span class="nx">create</span><span class="p">();</span>
          <span class="nx">m</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">pass</span><span class="p">);</span>
          <span class="kr">const</span> <span class="nx">hexPass</span> <span class="o">=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">hex</span><span class="p">().</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">32</span><span class="p">);</span>

          <span class="kr">const</span> <span class="nx">byteKey</span> <span class="o">=</span> <span class="nx">aesjs</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">hex</span><span class="p">.</span><span class="nx">toBytes</span><span class="p">(</span><span class="nx">hexPass</span><span class="p">);</span>
          <span class="kr">const</span> <span class="nx">aes</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">aesjs</span><span class="p">.</span><span class="nx">ModeOfOperation</span><span class="p">.</span><span class="nx">ctr</span><span class="p">(</span><span class="nx">byteKey</span><span class="p">,</span> <span class="k">new</span> <span class="nx">aesjs</span><span class="p">.</span><span class="nx">Counter</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
          <span class="kr">const</span> <span class="nx">linkBytes</span> <span class="o">=</span> <span class="nx">aesjs</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">hex</span><span class="p">.</span><span class="nx">toBytes</span><span class="p">(</span><span class="nx">link</span><span class="p">);</span>
          <span class="kr">const</span> <span class="nx">decryptedLink</span> <span class="o">=</span> <span class="nx">aesjs</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">hex</span><span class="p">.</span><span class="nx">fromBytes</span><span class="p">(</span><span class="nx">aes</span><span class="p">.</span><span class="nx">decrypt</span><span class="p">(</span><span class="nx">linkBytes</span><span class="p">));</span>
          <span class="kr">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="sb">`</span><span class="si">${</span><span class="nx">decryptedLink</span><span class="si">}</span><span class="sb">.html?key=</span><span class="si">${</span><span class="nx">hexPass</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
          <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">url</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div><p>Go to <a href="/secret/landing">the landing page</a> to try it out. The password is <code>pass</code>.</p><h1><img src="/svg/logo.svg" class="h1-img">Restrictions and Future Ideas</h1><p>The main restriction of this setup is it only works for one user. I'm sure there are algorithms that support multiple passwords but at that point it would make sense to switch to a dedicated password service.</p><p>Another small shortcoming is the title of secret pages always says &quot;Encrypted Page&quot;. I could fix this by encrypting the page title along with page contents and it would probably be more secure to encrypt them together. Maybe json would be a good encoding format. On the other hand, it is kinda cool that the page appears as &quot;Encrypted Page&quot; in my browser history.</p><p>Speaking of browser history, because the key is passed through the url, anyone can access my secret site by looking at my history. It also means I can bookmark a page and never need to type in the password again.</p><p><img src="encrypted_page.jpg" alt="History"></p><p>Now that I have an AES-secured secret site, I'm not sure what to do with it. Maybe I'll host some e-books I'm reading, or posts I'm working on, or a journal, or a todo list.</p><p>But whatever it is, I hope it's secure.</p></div></body></html>