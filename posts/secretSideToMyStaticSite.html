<!doctype html><html><head><meta charset="UTF-8"><meta charset="UTF-8"><meta name="viewport" content="width=device-width" initial-scale="1.0"><link rel="icon" type="image" href="/favicon/16x16.png" sizes="16x16"><link rel="icon" type="image" href="/favicon/32x32.png" sizes="32x32"><link rel="icon" type="image" href="/favicon/96x96.png" sizes="96x96"><link rel="stylesheet" href="/css/styles.css"><link rel="stylesheet" href="/css/highlight.css"><title>The Secret Side to My Static Site</title></head><body><div class="title">The Secret Side to My Static Site</div><div class="main"><div class="navbar"><span><a href="/">Home</a></span><span><a style="margin-left:3em;" href="/resume">Resume</a></span><span><a style="margin-left:3em;" href="/posts/list">Posts</a></span><span><a style="margin-left:3em;" href="/fractal">Fractal Generator</a></span><span><a style="margin-left:3em;" href="/webapp/index">Webapp</a></span></div><p>I host this website on github pages which means I don't have access to a server or database. My website is hosted on computers I don't own and is accessible by anyone.</p><p>And I want a login service.</p><p>Specifically I want a place where I can type in a password and gain access to private information. However, because my site is public and I haven't made a server, I have to be able to do this from any computer.</p><p>While I've been thinking about this problem for quite a while, it wasn't until I finished taking a cryptography class at college that I discovered a nice encryption algorithm for this problem: AES.</p><p>AES is a secure encryption algorithm where you encrypt data with a key. When you want your data back, you use the key again to decrypt. As far as I know, AES has a long enough key that it hasn't been cracked and it probably won't be cracked any time soon.</p><p>From a high level, I use sha256 to hash my password and AES to encrypt and decrypt the contents of my secret web pages. Here's the encryption process:</p><p><img src="_pics/website-encryption.svg" alt="encryption process"></p><p>The decryption process is very similar, except I use the password hash to decrypt the encrypted website.</p><p>Before encryption, my secret website looks like:</p><div class="highlight"><pre><span></span>main.html
other.html
</pre></div><p>When my website is encrypted, the file structure looks as follows:</p><div class="highlight"><pre><span></span>007a69b693fbc1f43f7ce8f4c9779621.html
222e1238c95503abd14586130ee685c1.html
aes.js
landing.html
sha256.js
</pre></div><p>The html files with hex names correspond to <code>main.html</code> and <code>other.html</code>, and the additional files are libraries to help decrypt the pages. These file names are randomly generated hex strings and have no connection to the file's name or contents which makes it harder for people to get any information from even the file structure.</p><p><code>aes.js</code> and <code>sha256.js</code> are encryption libraries I found online and <code>landing.html</code> is the webpage through which you access the private site.</p><p>My claim is that it is very hard to decode the webpages without the password.</p><p>For example, this is what <code>007a69b693fbc1f43f7ce8f4c9779621.html</code> looks like:</p><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Encrypted Page<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;aes.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/javascript&quot;</span><span class="p">&gt;</span>
    <span class="kr">const</span> <span class="nx">page</span> <span class="o">=</span> <span class="s1">&#x27;42df955a2a180ffdc2da342c5ab550524ba3a28cbb99cf1f1f13d57e338b8e480d7ad11a716239cad703a54a06a78ffcbccda81f69f1732f365fdc7cc6eed9fc8bd8d2535a4e7b78956a8dd6239e052e29fa96564c69218c0212cf4ad5dcb7d3727e1bf18dc93b10bf7e9408ee8c1206761540d25320294f0ae0a05ce5dee27b56b3c703dded0be07528c3f6013792fc34005e6bcd6c5d19220cb30ca83764aa13f16c056e711ade30ee55dab8dae42a172ebcbc3a9cec3f9ee30934264c8c20a5208ae1157567672d103ab7ddd6ef236c6a65959a7b6f91ca4814a51fdcace10d95b26b62c19c7c3afa70e2b1b05435c9cbe5e72c25b05e7a136fb1d075b7df447819244237b0c23c6ae79b39da3c5c0654b7a95a82d1be6f81a9c2cd5531fc&#x27;</span><span class="p">;</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">;</span>
      <span class="kr">const</span> <span class="nx">hexKey</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">&#x27;password hash&#x27;</span><span class="p">);</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">assert</span><span class="p">(</span><span class="nx">hexKey</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">);</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">assert</span><span class="p">(</span><span class="nx">hexKey</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">32</span><span class="p">);</span>
      <span class="kr">const</span> <span class="nx">byteKey</span> <span class="o">=</span> <span class="nx">aesjs</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">hex</span><span class="p">.</span><span class="nx">toBytes</span><span class="p">(</span><span class="nx">hexKey</span><span class="p">);</span>
      <span class="kr">const</span> <span class="nx">aes</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">aesjs</span><span class="p">.</span><span class="nx">ModeOfOperation</span><span class="p">.</span><span class="nx">ctr</span><span class="p">(</span><span class="nx">byteKey</span><span class="p">,</span> <span class="k">new</span> <span class="nx">aesjs</span><span class="p">.</span><span class="nx">Counter</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
      <span class="kr">const</span> <span class="nx">pageBytes</span> <span class="o">=</span> <span class="nx">aesjs</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">hex</span><span class="p">.</span><span class="nx">toBytes</span><span class="p">(</span><span class="nx">page</span><span class="p">);</span>
      <span class="kr">const</span> <span class="nx">decryptedBytes</span> <span class="o">=</span> <span class="nx">aes</span><span class="p">.</span><span class="nx">decrypt</span><span class="p">(</span><span class="nx">pageBytes</span><span class="p">);</span>
      <span class="kr">const</span> <span class="nx">decryptedPage</span> <span class="o">=</span> <span class="nx">aesjs</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">utf8</span><span class="p">.</span><span class="nx">fromBytes</span><span class="p">(</span><span class="nx">decryptedBytes</span><span class="p">);</span>
      <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">decryptedPage</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div><p>It's pretty hard to tell that hex string decrypts into the following page.</p><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Encrypted Page<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;aes.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Main Page<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Welcome to the ecnrypted page!<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>You are here because you managed to type in the correct password.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Here&#x27;s a link to the <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;222e1238c95503abd14586130ee685c1.html</span><span class="p">&gt;</span>other page<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div><p>When the page loads, it uses the hashed+salted password stored in <code>window.localStorage</code> to decrypt the page contents and sets the decrypted message as the body's innerHTML.</p><h1><img src="/svg/logo.svg" class="h1-img">The Landing Page</h1><p><code>landing.html</code> is very similar except it only stores the encrypted url of the first secret page.</p><p>To get the first link, the landing page:</p><ol><li>gets the first 128 bits of the sha256 of the password and a random salt.</li><li>uses those bits as an AES key to decrypt the link.</li><li>stores the hashed+salted password in <code>window.localStorage</code></li></ol><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Encrypted Page<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;aes.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;sha256.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/javascript&quot;</span><span class="p">&gt;</span>
    <span class="kr">const</span> <span class="nx">link</span> <span class="o">=</span> <span class="s1">&#x27;7f8dbd40a7dac976d04169bafa678c2b&#x27;</span><span class="p">;</span>
    <span class="kr">const</span> <span class="nx">salt</span> <span class="o">=</span> <span class="s1">&#x27;0e12d61a450492ec3600cc70fddb051e&#x27;</span><span class="p">;</span>
    <span class="kd">function</span> <span class="nx">login</span><span class="p">()</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">pass</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#x27;input&#x27;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">value</span><span class="p">;</span>
      <span class="kr">const</span> <span class="nx">m</span> <span class="o">=</span> <span class="nx">sha256</span><span class="p">.</span><span class="nx">create</span><span class="p">();</span>
      <span class="nx">m</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">pass</span><span class="p">);</span>
      <span class="nx">m</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">salt</span><span class="p">);</span>
      <span class="kr">const</span> <span class="nx">hexPass</span> <span class="o">=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">hex</span><span class="p">().</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">32</span><span class="p">);</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">&#x27;password hash&#x27;</span><span class="p">,</span> <span class="nx">hexPass</span><span class="p">);</span>
      <span class="kr">const</span> <span class="nx">byteKey</span> <span class="o">=</span> <span class="nx">aesjs</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">hex</span><span class="p">.</span><span class="nx">toBytes</span><span class="p">(</span><span class="nx">hexPass</span><span class="p">);</span>
      <span class="kr">const</span> <span class="nx">aes</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">aesjs</span><span class="p">.</span><span class="nx">ModeOfOperation</span><span class="p">.</span><span class="nx">ctr</span><span class="p">(</span><span class="nx">byteKey</span><span class="p">,</span> <span class="k">new</span> <span class="nx">aesjs</span><span class="p">.</span><span class="nx">Counter</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
      <span class="kr">const</span> <span class="nx">linkBytes</span> <span class="o">=</span> <span class="nx">aesjs</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">hex</span><span class="p">.</span><span class="nx">toBytes</span><span class="p">(</span><span class="nx">link</span><span class="p">);</span>
      <span class="kr">const</span> <span class="nx">decryptedLink</span> <span class="o">=</span> <span class="nx">aesjs</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">hex</span><span class="p">.</span><span class="nx">fromBytes</span><span class="p">(</span><span class="nx">aes</span><span class="p">.</span><span class="nx">decrypt</span><span class="p">(</span><span class="nx">linkBytes</span><span class="p">));</span>
      <span class="kr">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="sb">`</span><span class="si">${</span><span class="nx">decryptedLink</span><span class="si">}</span><span class="sb">.html`</span><span class="p">;</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">url</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">input</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#x27;input&#x27;</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
      <span class="nx">input</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#x27;keydown&#x27;</span><span class="p">,</span> <span class="nx">event</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">key</span> <span class="o">===</span> <span class="s1">&#x27;Enter&#x27;</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">login</span><span class="p">();</span>
        <span class="p">}</span>
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>Password:<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">onclick</span><span class="o">=</span><span class="s">&quot;login()&quot;</span><span class="p">&gt;</span>Click to login<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div><p>If you want to give it a try, here's <a href="/secret/landing">the landing page</a> and the password is <code>pass</code>.</p><h1><img src="/svg/logo.svg" class="h1-img">Restrictions and Future Ideas</h1><p>The main restriction of this setup is it only works for one user. I'm sure there are algorithms that support multiple passwords but at that point it would make sense to switch to a dedicated password service.</p><p><strong>Pro</strong>: The password isn't stored and the hashed password never even leaves your computer.</p><p><strong>Con</strong>: If a malicious person gets a hold of a computer with the hashed password in localstorage, they can use it to access secret webpages.</p><p><strong>Pro</strong>: That malicious person can't get the original password.</p><p><strong>Pro</strong>: I can regenerate the website which generates a new random salt and invalidates all current logins.</p><p>This setup means I can go on a random computer and browse my secret site in igcognito mode. When I close the browser, localstorage clears and I probably won't leave a trace.</p><p><strong>Con</strong>: The title of secret pages always says &quot;Encrypted Page&quot;. I could fix this by encrypting the page title along with page contents and it would probably be more secure to encrypt them together. Maybe json would be a good encoding format.</p><p><strong>Pro</strong>: On the other hand, it is kinda cool that the page appears as &quot;Encrypted Page&quot; in my browser history.</p><p>Now that I have an AES-secured secret site, I'm not sure what to do with it. Maybe I'll host some e-books I'm reading, or posts I'm working on, or a journal, or a todo list.</p><p>But whatever it is, I think it'll be secure.</p></div></body></html>